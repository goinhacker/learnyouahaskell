# 모나드의 등장 이유

펑터 어떤 컨텍스트 내의 값을 변경\(mapped over\)할때 유용한 개념이었습니다. 그리고나서 특정 데이터 타입의 값을 컨텍스트가 있는 값으로 보고, 컨텍스트를 유지하면서 해당 값에 함수를 적용할 수 있게 해주는 애플리케이티브 펑터를 도입하여 개념을 한 단계 발전 시켰습니다. 이번 챕터에서는 애플리케이티브 펑터를 발전시킨 모나드에 대해서 배울 것 입니다.

처음 펑터를 배울때 다양한 데이터 타입에 map 함수를 사용할 수 있음을 보았습니다. 그리고 이를 위해서 `Functor` 타입클래스를 사용했습니다. `a -> b` 타입의 함수와 `f a` 타입이 있을때, 펑터를 사용해서 `f b`로 바꾸었습니다. 그리고 이 작업은 `Maybe a`, `[a]`, `IO a` 등등에 적용할 수 있었습니다. 심지어 `a -> b` 함수와 `r -> a`를 맵핑해서 `r -> b`로 만들수도 있었습니다. 이러한 모든 작업에 대한 답은 바로 fmap 함수입니다. 

```haskell
fmap :: (Functor f) => (a -> b) -> f a -> f b
```

여기에 적절한 펑터 인스턴스를 작성해서 데이터 타입에 맞게 동작하도록 하면됩니다. 하지만 펑터에도 한계는 있었습니다. 예를들어 `Just (*3)`와 `Just 5`, `Just 5`와 `Nothing`, `[(*2), (+4)]`와 `[1,2,3]`을 가지고 펑터에 적용할 수는 없습니다. 즉, 값에 적용할 함수가 이미 펑터안에 있다면, 일반 펑터로 처리할 수 없었습니다. 그래서 `Applicative` 타입클래스가 나왔습니다. 그리고 애플리케이티브 펑터는 `<*>` 함수를 사용해서 이러한 문제를 해결합니다.

```haskell
(<*>) :: (Applicative f) => f (a -> b) -> f a -> f b
```

또한 애플리케이티브 펑터는 `pure` 함수를 사용해서 어떤 값을 래핑할 수 있었습니다. 예를들어 `1`을 `Just 1` 또는 `[1]`로 래핑할 수 있습니다. 이 함수는 어떤 값을 의미있는 컨텍스트안에 넣습니다. 각각의 의미는 아래와 같습니다. 

*  `Maybe a`는 실패할 가능성이 있는 연산
*  `[a]`는 여러개의 결과\(non-deterministic computaions\)들을 가질 수 있는 연산
*  `IO a`는 부수효과가 존재하는 값

{% hint style="info" %}
책에서는 Maybe a, \[a\], IO a와 같이 어떤 컨텍스트안에 들어간 값을 **fancy value**라고 합니다. 지금부터는 편의상 제 맘대로 컨텍스트값이라 하겠습니다.
{% endhint %}

 `Applicative`를 활용하면 이런 컨텍스트를 유지하면서 함수와 값들을 사용할 수 있었습니다.

```haskell
ghci> (*) <$> Just 2 <*> Just 8  
Just 16  
ghci> (++) <$> Just "klingon" <*> Nothing  
Nothing  
ghci> (-) <$> [3,4] <*> [1,2,3]  
[2,1,0,3,2,1]
```

모나드는 애플리케이티브 펑터의 자연스러운 확장입니다. 만약 어떤 컨텍스트값, `m a`를 가지고 있을때, `a -> m b` 타입의 함수를 `m a` 타입의 값에 적용할 수 있을까요? 이 작업을 위해서는 아래와 같은 함수가 필요합니다.

```haskell
(>>=) :: (Monad m) => m a -> (a -> m b) -> m b
```

**만약 컨텍스트값과 일반 값을 받아서 컨텍스트값을 반환하는 함수를 가지고 있을때, 어떻게 컨텍스트값을 함수에 넣을 수 있을까요?** 이것이 모나드를 다룰때 우리가 생각해야할 중요한 질문입니다. 이제부터는 `f a` 대신에 `m a`를 사용합니다. 여기서 `m`은 `Monad`를 의미합니다. 하지만 모나드는 결국 `>>=` 함수를 지원하는 애플리케이티브 펑터입니다. 그리고 `>>=` 함수는 바인드\(bind\)라고 부릅니다.

값 `a`와 `a -> b` 함수를 가질고 있을때는 함수에 값을 넣기가 매우 쉽니다. 그냥 함수에 값을 적용하면 됩니다. 하지만 어떤 컨텍스트를 가진 값을 다룰때는 이 컨텍스트값이 함수에 어떻게 반영되고 동작할지에 대해서 고민해야 합니다.

